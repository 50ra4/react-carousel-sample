{"version":3,"file":"Carousel.stories.cabf86cd.js","sources":["../../../src/presentation/components/Carousel/Carousel.tsx"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n  useMemo,\n} from 'react';\nimport styled from 'styled-components';\n\nexport type CarouselItem = {\n  key: string;\n  caption: string;\n};\n\nexport type CarouselOptions = {\n  /** autoplay milliseconds. default: no autoplay */\n  autoplay?: number;\n};\n\nexport type CarouselProps = {\n  className?: string;\n  carouselKey: string;\n  items: CarouselItem[];\n  options?: CarouselOptions;\n};\n\nconst createSlideId = (carouselKey: string, itemKey: string) =>\n  `${carouselKey}_${itemKey}`;\n\nconst getNextCarouselItem = (items: CarouselItem[], currentIndex: number) =>\n  currentIndex === items.length - 1 ? items[0] : items[currentIndex + 1];\n\nexport function Carousel({\n  className,\n  carouselKey,\n  items,\n  options: { autoplay } = {},\n}: CarouselProps) {\n  const rootRef = useRef<HTMLDivElement | null>(null);\n\n  const scrollToSlide = useCallback((id: string) => {\n    const target: HTMLElement | undefined =\n      rootRef.current?.querySelector(`#${id}`) ?? undefined;\n    if (!target) {\n      return;\n    }\n    target.scrollIntoView();\n  }, []);\n\n  const slides = useMemo(\n    () =>\n      items.map((item) => ({\n        ...item,\n        slideId: createSlideId(carouselKey, item.key),\n      })),\n    [carouselKey, items],\n  );\n\n  const [currentSlideId, setCurrentSlideId] = useState(slides[0].slideId);\n\n  useEffect(() => {\n    if (!rootRef.current) {\n      return;\n    }\n\n    const callback: IntersectionObserverCallback = (entries) => {\n      entries.forEach((entry) => {\n        if (!entry.isIntersecting) {\n          return;\n        }\n        setCurrentSlideId(entry.target.id);\n      });\n    };\n\n    const observer = new IntersectionObserver(callback, {\n      root: rootRef.current,\n      threshold: 1,\n    });\n\n    const elements = slides\n      .map(({ slideId }) => document.querySelector(`#${slideId}`))\n      .filter((v): v is NonNullable<typeof v> => !!v);\n\n    elements.forEach((elm) => {\n      observer.observe(elm);\n    });\n\n    return () => {\n      elements.forEach((elm) => {\n        observer.unobserve(elm);\n      });\n    };\n  }, [carouselKey, slides]);\n\n  const [isHover, setIsHover] = useState(false);\n\n  useEffect(() => {\n    if (!autoplay) {\n      return;\n    }\n\n    if (isHover) {\n      return;\n    }\n\n    const currentSlideIndex = slides.findIndex(\n      (slide) => slide.slideId === currentSlideId,\n    );\n    if (currentSlideIndex < 0) {\n      return;\n    }\n\n    const timer = setInterval(() => {\n      const nextSlideId = createSlideId(\n        carouselKey,\n        getNextCarouselItem(slides, currentSlideIndex).key,\n      );\n\n      scrollToSlide(nextSlideId);\n    }, autoplay);\n\n    return () => {\n      clearInterval(timer);\n    };\n  }, [autoplay, carouselKey, currentSlideId, isHover, scrollToSlide, slides]);\n\n  return (\n    <Root\n      ref={rootRef}\n      className={className}\n      onMouseEnter={() => {\n        setIsHover(true);\n      }}\n      onMouseLeave={() => {\n        setIsHover(false);\n      }}\n    >\n      <Slider>\n        {slides.map(({ slideId }, i) => (\n          <Slide key={slideId} id={slideId}>\n            <Snapper />\n            <NavigationPreview\n              onClick={() => {\n                const targetId = createSlideId(\n                  carouselKey,\n                  i === 0 ? items[items.length - 1].key : items[i - 1].key,\n                );\n                scrollToSlide(targetId);\n              }}\n            >\n              Go to previous slide\n            </NavigationPreview>\n            <NavigationNext\n              onClick={() => {\n                const targetId = createSlideId(\n                  carouselKey,\n                  getNextCarouselItem(slides, i).key,\n                );\n                scrollToSlide(targetId);\n              }}\n            >\n              Go to next slide\n            </NavigationNext>\n          </Slide>\n        ))}\n      </Slider>\n      <Navigation>\n        <NavigationList className={className}>\n          {slides.map(({ slideId, caption }) => (\n            <NavigationItem key={slideId}>\n              <NavigationButton\n                onClick={() => {\n                  scrollToSlide(slideId);\n                }}\n              >\n                Go to {caption}\n              </NavigationButton>\n            </NavigationItem>\n          ))}\n        </NavigationList>\n      </Navigation>\n    </Root>\n  );\n}\n\nconst Snapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  scroll-snap-align: center;\n`;\n\nconst Slide = styled.li`\n  position: relative;\n  flex: 0 0 100%;\n  width: 100%;\n  background-color: #f99;\n  counter-increment: item;\n\n  &:nth-child(even) {\n    background-color: #99f;\n  }\n\n  &:before {\n    content: counter(item);\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate3d(-50%, -40%, 70px);\n    color: #fff;\n    font-size: 2em;\n  }\n`;\n\nconst Root = styled.div`\n  position: relative;\n  padding-top: 75%;\n  filter: drop-shadow(0 0 10px #0003);\n  perspective: 100px;\n`;\n\nconst Slider = styled.ol`\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  overflow-x: scroll;\n  counter-reset: item;\n  scroll-behavior: smooth;\n  scroll-snap-type: x mandatory;\n`;\n\nconst Navigation = styled.aside`\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  text-align: center;\n`;\nconst NavigationList = styled.ol`\n  display: inline-block;\n`;\nconst NavigationItem = styled.li`\n  display: inline-block;\n`;\nconst NavigationButton = styled.button`\n  display: inline-block;\n  cursor: pointer;\n  width: 16px;\n  height: 16px;\n  background-color: #333;\n  border-radius: 50%;\n  border: none;\n  margin: 0 4px 24px;\n  font-size: 0;\n  transition: transform 0.1s;\n`;\n\nconst ArrowButton = ({\n  className,\n  onClick,\n  children,\n}: {\n  className?: string;\n  onClick: () => void;\n  children?: React.ReactNode;\n}) => {\n  return (\n    <ArrowCircle className={className} onClick={onClick}>\n      <ArrowTriangle />\n      {children}\n    </ArrowCircle>\n  );\n};\n\nconst ArrowCircle = styled.button`\n  cursor: pointer;\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  font-size: 0;\n  outline: 0;\n  border: none;\n  background-color: #333;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\nconst ArrowTriangle = styled.div`\n  margin-right: 7.5px;\n  width: 0;\n  height: 0;\n  border-style: solid;\n  border-width: 10px 12.5px 10px 0;\n  border-color: transparent #ffe transparent transparent;\n`;\n\nconst NavigationPreview = styled(ArrowButton)`\n  margin-top: 37.5%;\n  transform: translateY(-50%);\n  position: absolute;\n  top: 0;\n  left: 8px;\n`;\n\nconst NavigationNext = styled(ArrowButton)`\n  margin-top: 37.5%;\n  transform: translateY(-50%) rotate(180deg);\n  position: absolute;\n  top: 0;\n  right: 8px;\n`;\n"],"names":["createSlideId","__name","carouselKey","itemKey","getNextCarouselItem","items","currentIndex","Carousel","className","autoplay","rootRef","useRef","scrollToSlide","useCallback","id","target","_b","_a","slides","useMemo","item","currentSlideId","setCurrentSlideId","useState","useEffect","callback","entries","entry","observer","current","elements","slideId","isHover","setIsHover","currentSlideIndex","slide","timer","nextSlideId","clearInterval","_jsxs","Root","_jsx","Slider","targetId","i","NavigationNext","Navigation","NavigationList","caption","NavigationButton","Snapper","styled","Slide","NavigationItem","ArrowButton","onClick","ArrowCircle","ArrowTriangle","children","NavigationPreview"],"mappings":"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"}